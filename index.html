<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
    <script src="plot.js"></script>
    <script src="layers.js"></script>
    <script src="util.js"></script>
    <script src="map.js"></script>
    <link rel="stylesheet" href="style.css" />

    <title>D3 Sf</title>
  </head>
  <body>
    <script>
      // loading donut
      loadingArc();

      // load all data
      d3.queue()
        .defer(f => {
          d3.json("data/euSfGeo.json")
            .on("progress", e => {
              if (e.lengthComputable) {
                let percentageComplete = Math.floor((e.loaded / e.total) * 100);
                console.log(`Plot Data % ${percentageComplete}`);
                let foreground = d3.select(".foreground");
                foreground
                  .transition()
                  .duration(1000)
                  .ease(d3.easeLinear)
                  .attrTween("d", d => {
                    let interpolate = d3.interpolate(
                      d.endAngle,
                      2 * Math.PI * (e.loaded / e.total)
                    );
                    return function(t) {
                      d.endAngle = interpolate(t);
                      return getArc()(d);
                    };
                  });
              }
            })
            .get((error, data) => {
              f(error, data);
            });
        })
        .defer(d3.json, "data/PoliceDistricts.json")
        .defer(f => {
          d3.csv("data/2018pdi.csv")
            .on("progress", e => {
              e.preventDefault();

              if (e.lengthComputable) {
                let percentageComplete = Math.floor((e.loaded / e.total) * 100);
                console.log(`Plot Data % ${percentageComplete}`);
                let foreground = d3.select(".foreground");
                foreground
                  .transition()
                  .duration(1000)
                  .ease(d3.easeLinear)
                  .attrTween("d", d => {
                    let interpolate = d3.interpolate(
                      d.endAngle,
                      2 * Math.PI * (e.loaded / e.total)
                    );
                    return function(t) {
                      d.endAngle = interpolate(t);
                      return getArc()(d);
                    };
                  });
              }
            })
            .get((error, data) => {
              f(error, data);
            });
        })
        .await((err, mapData, pdData, dotData) => {
          d3.selectAll("#loadingArc").remove();
          setupMap({ err, mapData, pdData, dotData });
        });
    </script>
    <label>Enter a date before 1989-10-30:</label>
    <input type="date" name="myDate" max="2018-01-01" />

    <label>Enter a date after 2001-01-01:</label>
    <input type="date" name="myDate" min="2018-03-30" />
  </body>
</html>
